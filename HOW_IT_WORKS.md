# Як працює Geo IP Lookup додаток: Деталі для початківців

## Вступ

Цей документ пояснює, як працює наш додаток Geo IP Lookup, який дозволяє отримувати географічні дані про IP-адреси з використанням проксі-серверів з різних країн. Документ розрахований на початківців, які тільки починають вивчати веб-розробку.

## Загальна архітектура

Наш додаток складається з двох основних частин:

1. **Фронтенд** (клієнтська частина) - HTML/CSS/JavaScript, який відображається у браузері користувача
2. **Бекенд** (серверна частина) - Node.js сервер, який обробляє запити

![Архітектура додатку](https://i.imgur.com/JWqTn5r.png)

## Чому нам потрібен сервер?

Новачки часто запитують: "Чому ми не можемо просто використовувати JavaScript у браузері для всього?" Для цього є декілька важливих причин:

### 1. Обмеження CORS (Cross-Origin Resource Sharing)

Браузери мають обмеження безпеки, які не дозволяють веб-сторінкам напряму звертатися до сторонніх API, якщо ці API спеціально не налаштовані для прийняття таких запитів. Наш сервер діє як проміжний шар, який може робити ці запити від імені клієнта.

### 2. Використання проксі-серверів

**Найголовніше**: браузери не дозволяють JavaScript напряму використовувати проксі-сервери. Це обмеження безпеки. Коли ми хочемо, щоб запит виглядав так, ніби він надходить з іншої країни (наприклад, з Казахстану), нам потрібен сервер, який може налаштувати з'єднання через проксі.

### 3. Приховування чутливих даних

Наш додаток використовує облікові дані для авторизації на проксі-серверах. Ці дані повинні залишатися прихованими від користувачів. Якби ми включили їх у JavaScript на фронтенді, будь-хто міг би їх побачити та використати.

## Як працюють компоненти

### 1. HTML (index.html)

HTML-файл - це структура нашого додатку, яку бачить користувач. Він містить:
- Заголовки
- Випадаючий список для вибору країни
- Кнопка для запуску пошуку
- Контейнер для відображення результатів
- Посилання на JavaScript-код, який виконує дії

```html
<!DOCTYPE html>
<html>
  <head>...</head>
  <body>
    <div class="container">
      <h1>Geo IP Lookup</h1>
      <select id="location">
        <option value="default">Default (No Proxy)</option>
        <option value="kazakhstan">Kazakhstan</option>
        ...
      </select>
      <button id="getLocationBtn">Get Location Data</button>
      <div class="results">...</div>
    </div>
    <script>...</script>
  </body>
</html>
```

### 2. JavaScript у браузері

Коли користувач натискає кнопку, JavaScript у браузері:
1. Зчитує вибрану країну з випадаючого списку
2. Показує повідомлення про завантаження
3. Відправляє запит на НАШ сервер (не напряму на IP API)
4. Отримує відповідь і відображає її на сторінці

```javascript
document.getElementById("getLocationBtn").addEventListener("click", function () {
  // Отримати вибрану країну
  const location = document.getElementById("location").value;
  
  // Показати повідомлення про завантаження
  resultsDiv.innerHTML = "<p>Loading data...</p>";
  
  // Запит до нашого сервера
  fetch(`http://localhost:3000/api/geo/${location}`)
    .then(response => response.json())
    .then(data => {
      // Відображення результатів
      resultsDiv.innerHTML = `...`;
    });
});
```

### 3. Node.js сервер (server.js)

Наш сервер виконує найскладнішу частину роботи:

1. **Прослуховує запити**: Сервер постійно прослуховує порт 3000, чекаючи на запити
2. **Обробляє різні шляхи**: В залежності від URL, він виконує різні дії
3. **Використовує проксі** (або ні): Залежно від обраної країни
4. **Передає дані назад**: Відправляє результати назад у браузер

```javascript
const express = require("express");
const axios = require("axios");
// інші імпорти...

// Налаштування проксі для різних країн
const proxySettings = {
  kazakhstan: { /* налаштування проксі */ },
  // інші країни...
};

app.get("/api/geo/:country", async (req, res) => {
  const country = req.params.country;
  
  // Якщо default - запит без проксі
  if (country === 'default') {
    const response = await axios.get("http://ip-api.com/json/");
    return res.json(response.data);
  }
  
  // Інакше - використовуємо проксі для вказаної країни
  const proxyConfig = proxySettings[country];
  const response = await axios.get("http://ip-api.com/json/", {
    proxy: { /* налаштування проксі */ }
  });
  
  res.json(response.data);
});
```

## Детальний потік даних

Давайте розберемо, що відбувається, коли користувач натискає кнопку "Get Location Data":

1. **Користувач вибирає країну** (наприклад, "Kazakhstan") і натискає кнопку.
2. **JavaScript на фронтенді** фіксує цю подію і робить запит до `http://localhost:3000/api/geo/kazakhstan`.
3. **Наш сервер** отримує цей запит і бачить, що він для Казахстану.
4. **Сервер налаштовує проксі** - він буде використовувати проксі-сервер, розташований у Казахстані.
5. **Сервер робить запит до IP API** через цей казахстанський проксі.
6. **IP API** думає, що запит прийшов з Казахстану, і повертає відповідні дані.
7. **Наш сервер** отримує ці дані і передає їх назад на фронтенд.
8. **JavaScript на фронтенді** отримує дані і відображає їх користувачеві.

## Використані технології

- **HTML/CSS** - для структури та стилізації сторінки
- **JavaScript** (у браузері) - для інтерактивності на стороні клієнта
- **Node.js** - середовище виконання JavaScript на сервері
- **Express** - фреймворк для спрощення створення серверів на Node.js
- **Axios** - бібліотека для виконання HTTP-запитів з сервера
- **ip-api.com** - зовнішній API, який надає дані про геолокацію IP-адрес

## Особливі моменти для початківців

### 1. Асинхронні операції

У JavaScript багато операцій є асинхронними, особливо мережеві запити. Тому ми використовуємо:
- `async/await` - для більш читабельного асинхронного коду
- `Promise` і методи `then/catch` - для обробки результатів асинхронних операцій

### 2. CORS і безпека браузера

Сучасні браузери мають суворі правила безпеки, які обмежують те, що може робити JavaScript на сторінці. Наприклад, код не може просто так звернутися до API на іншому домені - це має бути явно дозволено сервером за допомогою заголовків CORS.

### 3. Проксі-сервери

Проксі-сервер діє як посередник між нашим сервером та IP API. Коли IP API отримує запит, він бачить IP-адресу проксі-сервера, а не нашого сервера. Це дозволяє нам "маскуватися" під користувача з іншої країни.

## Як запустити і протестувати додаток

1. Встановіть залежності: `npm install`
2. Запустіть сервер: `npm start`
3. Відкрийте браузер і перейдіть за адресою: `http://localhost:3000`
4. Виберіть країну з випадаючого списку та натисніть кнопку "Get Location Data"
5. Спостерігайте за результатами - вони будуть відображатися на сторінці

## Висновок

Хоча цей додаток здається простим, він демонструє важливі концепції сучасної веб-розробки:
- Розділення клієнтської та серверної частин
- Використання API для отримання даних
- Маніпулювання мережевим трафіком через проксі
- Безпека та обхід обмежень браузера

Розуміння цих концепцій закладає міцний фундамент для подальшого вивчення веб-розробки.
